<!DOCTYPE html>
<html lang="en" manifest="cache.appcache">
<head>
 <meta charset="utf-8">
 <title>fliplogic</title>

 <meta name="HandheldFriendly" content="True">
 <meta name="MobileOptimized" content="320">
 <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0, maximum-scale=1, user-scalable=no, minimal-ui">

<style>

html {
font-family: sans-serif;
-ms-text-size-adjust: 100%;
-webkit-text-size-adjust: 100%;
}
html,body {
margin: 0;
min-width: 100px;
min-height: 100px;
}

.zeropoint{
 position: absolute;
 left: 50%;
 top: 50%;
 width:10%;
 height:10%;
 transform: translate(-50%, -50%);

 max-width: 100px;
 max-height: 100px; 
}

.infobox{
 position: absolute;
 left: 50%;
 top: 50%;
 transform: translate(-50%, -50%);
/* background: orange;
 border: 3px solid #F10;
*/
 opacity: 0.5;
}

.infobox h1{
 font-size: 2em;
}

.gamebox{
 position: absolute;
 top: 0%;
 left: 0%;
 width:99%;
 height:99%;
 background: green;
 border-radius: 5px;
/* border: 1px solid #000;*/
}

.gamebox-fx{
 transition: left 1.3s, top 1.3s;
 moz-transition: left 1.3s, top 1.3s;
}

</style>

</head>

<!--
<body ondragstart="return false;" ondrop="return false;">
-->
<body>
  <div class="zeropoint"></div>

  <div class="infobox" style="visibility:hidden;">
    <h1>Level complite!!!</h1>
  </div>

<script src="jquery-2.1.1.min.js"></script>

<script src="game.js"></script>

<script>

const COLORS = ["orange","gray","blue"];
const IMM_COLOR = "black";

function checkBoxesColor(){
var boxes=document.querySelectorAll(".gamebox");
var color = boxes[0].style.backgroundColor;
for (var i=1;i<boxes.length;i++){
 if( boxes[i].style.backgroundColor == IMM_COLOR ) {continue;}
 if( boxes[i].style.backgroundColor != color ) {return false;}
}
return true;
}

function updateColor(e){

var ci=COLORS.indexOf(e.style.backgroundColor); 
if(ci>=0){
 ci=(ci+1) % COLORS.length; 
 e.style.backgroundColor = COLORS[ci];
}
else{
 e.style.backgroundColor = COLORS[0];
}

}

/*
function onmousedown(e){
console.log("onmousedown:",e);

}

function onmouseup(e){
console.log("onmouseup:",e);
}
*/

/*

var timer;
var status = 1;

function singleClick(event) {
 status = 1;
 timer = setTimeout(function() {
  if (status == 1) {
    console.log('single click !');
    onclick(event);
  }
 }, 250);
}

function doubleClick(event) {
 clearTimeout(timer);
 status = 0;
 console.log('double click !');
}


function ondblclick(e){
console.log("ondblclick");
console.log(e.target.style.backgroundColor);
console.log(e.target.style.left);
console.log(e.target.style.top);
return false;
}
*/

function onclick(e){
console.log(e.target.style.backgroundColor);
console.log(e.target.style.left);
console.log(e.target.style.top);

//updateColor(e.target);

var eleft=parseInt(e.target.style.left.slice(0, -1));
var etop=parseInt(e.target.style.top.slice(0, -1));

console.log(eleft);console.log(etop);

var boxes=document.querySelectorAll(".gamebox");
for (var i=0;i<boxes.length;i++){
 var x=boxes[i];
 if(x.style.backgroundColor == IMM_COLOR){continue;}
 var xleft=parseInt(x.style.left.slice(0, -1));
 var xtop=parseInt(x.style.top.slice(0, -1));
// console.log(eleft); console.log(etop);
 if( Math.abs(xleft - eleft) <= 100 && Math.abs(xtop - etop) <= 100 ){
//  updateColor(boxes[i]);
 //console.log(x,xleft,xtop,Math.abs(xleft - eleft),Math.abs(xtop - etop));
 updateColor(x);
 }
}

if(checkBoxesColor()){
console.log("Yooohoooooooooooooooooo!!!");
levelUpdate(game.i+1);
}


}



function levelUpdate(l)
{

if(l>=game.l.length || l<0){ console.log("wrong level",l);return;}

var zp=document.querySelector(".zeropoint");


//zp.innerText = '';

while (zp.firstChild) {
    zp.removeChild(zp.firstChild);
}

for(var i=0;i<game.l[l].length;i++){
 var gb = document.createElement("div");
 gb.setAttribute('class', 'gamebox gamebox-fx');
 gb.setAttribute('gindex',i);
// gb.setAttribute('style', 'left:'+(game.l[l][i][0]*100)+'%; top:'+(game.l[l][i][1]*100)+'%; background:'+game.l[l][i][2]+';');
 gb.setAttribute('style', 'background:'+game.l[l][i][2]+';');

 zp.appendChild(gb);
}



var boxes=document.querySelectorAll(".gamebox");
console.log(boxes);
for (var j=0;j<boxes.length;j++){
  boxes[j].onclick=onclick;  
}


setTimeout(function() {

var boxes=document.querySelectorAll(".gamebox");
for (var j=0;j<boxes.length;j++){
  var i=boxes[j].getAttribute('gindex');
  boxes[j].setAttribute('style','left:'+(game.l[l][i][0]*100)+'%; top:'+(game.l[l][i][1]*100)+'%; background:'+game.l[l][i][2]+';');
}


}, 0);


game.i=l;

}


(function(){

//levelUpdate(0);
/*

var gb1 = document.createElement("div"); 
gb1.setAttribute('class', 'gamebox'); gb1.setAttribute('style', 'left:0%;top:0%;background:red;');
zp.appendChild(gb1);

var gb2 = document.createElement("div"); 
gb2.setAttribute('class', 'gamebox'); gb2.setAttribute('style', 'left:100%;top:100%;background:orange;');
zp.appendChild(gb2);

var gb3 = document.createElement("div"); 
gb3.setAttribute('class', 'gamebox'); gb3.setAttribute('style', 'left:-100%;top:-100%;background:blue;');
zp.appendChild(gb3);

*/
/*
var gb4 = document.createElement("div"); 
gb4.setAttribute('class', 'gamebox'); gb4.setAttribute('style', 'left:-100%;top:-200%;background:red;');
zp.appendChild(gb4);

var gb5 = document.createElement("div"); 
gb5.setAttribute('class', 'gamebox'); gb5.setAttribute('style', 'left:-200%;top:-200%;background:yellow;');
zp.appendChild(gb5);


var gb6 = document.createElement("div"); 
gb6.setAttribute('class', 'gamebox'); gb6.setAttribute('style', 'left:+200%;top:-200%;background:orange;');
zp.appendChild(gb6);

var gb7 = document.createElement("div"); 
gb7.setAttribute('class', 'gamebox'); gb7.setAttribute('style', 'left:+300%;top:-200%;background:gray;');
zp.appendChild(gb7);

var gb8 = document.createElement("div"); 
gb8.setAttribute('class', 'gamebox'); gb8.setAttribute('style', 'left:+300%;top:-300%;background:gray;');
zp.appendChild(gb8);

var gb9 = document.createElement("div"); 
gb9.setAttribute('class', 'gamebox'); gb9.setAttribute('style', 'left:-300%;top:-300%;background:orange;');
zp.appendChild(gb9);


var gb10 = document.createElement("div"); 
gb10.setAttribute('class', 'gamebox'); gb10.setAttribute('style', 'left:100%;top:-100%;background:red;');
zp.appendChild(gb10);
*/


}());

function resize(){
 console.log('resize!')

var box=document.querySelector(".zeropoint");        

//var ww=window.innerWidth;
//var wh=window.innerHeight;

//var ww=document.body.clientWidth;
//var wh=document.body.clientHeight;

var ww=window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
var wh=window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight; 


var wm=Math.min(ww,wh);
const p=0.125;
const maxw=100;
const maxh=100;
console.log(ww);
console.log(wh);
var nw=Math.round(wm*p);if(nw>maxw){nw=maxw;}
var nh=Math.round(wm*p);if(nh>maxh){nh=maxh;}
console.log(nw);console.log(nh);
box.style.width=nw+"px";
box.style.height=nh+"px";
}

/*
document.body.addEventListener("keydown", function (e) {
console.log("keydown");
});

document.body.addEventListener("keyup", function (e) {
console.log("keyup");
});
*/
/*
document.body.addEventListener("mousedown", function (e) {
console.log("mousedown");
});

document.body.addEventListener("mouseup", function (e) {
console.log("mouseup");
});
*/

window.addEventListener("mousedown", function (e) {
console.log("mousedown");
console.log(e.target);
return false;
});

window.addEventListener("mouseup", function (e) {
console.log("mouseup");
console.log(e.target);
return false;
});

window.addEventListener("load", function () {
console.log("load");
resize();
levelUpdate(0);
});

window.addEventListener("resize", function(){
 resize();
}, true);

</script>
</body>
</html>




